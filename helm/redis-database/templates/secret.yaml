apiVersion: v1
kind: Secret
metadata:
  name: {{ include "redis-database.fullname" . }}-secret
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "redis-database.labels" . | nindent 4 }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
stringData:
  # Admin password (full access for ops/debugging)
  redis-password: {{ .Values.redis.auth.password | quote }}
  {{- if .Values.ha.sentinel.enabled }}
  sentinel-password: {{ .Values.redis.auth.sentinel.password | quote }}
  {{- end }}
  {{- if .Values.redis.acl.enabled }}
  # Per-service ACL user passwords
  {{- if .Values.redis.acl.users.auth.enabled }}
  auth-service-password: {{ .Values.redis.acl.users.auth.password | default (randAlphaNum 32) | quote }}
  {{- end }}
  {{- if .Values.redis.acl.users.scraper.enabled }}
  scraper-service-password: {{ .Values.redis.acl.users.scraper.password | default (randAlphaNum 32) | quote }}
  {{- end }}
  {{- if .Values.redis.acl.users.user.enabled }}
  user-service-password: {{ .Values.redis.acl.users.user.password | default (randAlphaNum 32) | quote }}
  {{- end }}
  {{- if .Values.redis.acl.users.notification.enabled }}
  notification-service-password: {{ .Values.redis.acl.users.notification.password | default (randAlphaNum 32) | quote }}
  {{- end }}
  {{- if .Values.redis.acl.users.mealplan.enabled }}
  mealplan-service-password: {{ .Values.redis.acl.users.mealplan.password | default (randAlphaNum 32) | quote }}
  {{- end }}
  {{- end }}
